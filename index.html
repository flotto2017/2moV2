<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ครูเอฟ จินตคณิต</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <style>
    :root {
      --bg: #f2f7ff;
      --bg-dark: #050816;
      --card-bg: #ffffff;
      --card-bg-dark: #0f172a;
      --text-main: #0f172a;
      --text-sub: #64748b;
      --text-main-dark: #e5e7eb;
      --text-sub-dark: #9ca3af;

      --accent: #fb923c;
      --accent-soft: #fed7aa;
      --accent-strong: #f97316;

      --accent2: #38bdf8;
      --border-soft: rgba(148,163,184,0.35);
      --shadow-soft: 0 10px 30px rgba(15,23,42,0.12);

      --btn-muted: #6b7280;
      --btn-danger: #ef4444;
      --btn-secondary: #9ca3af;
      --btn-success: #22c55e;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 20px;
      background: var(--bg);
      color: var(--text-main);
      transition: background 0.3s ease, color 0.3s ease;
      -webkit-tap-highlight-color: transparent;
    }
    body.dark-mode {
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000 100%);
      color: var(--text-main-dark);
    }

    body.pseudo-fullscreen {
      padding-top: 0;
      justify-content: center;
      align-items: stretch;
    }
    body.pseudo-fullscreen .box {
      width: 100vw;
      max-width: 100vw;
      height: 100vh;
      border-radius: 0;
    }

    .box {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--shadow-soft);
      width: 94%;
      max-width: 480px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 18px 16px 22px;
      border: 1px solid var(--border-soft);
      position: relative;
      overflow: hidden;
    }
    body.dark-mode .box {
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      border-color: rgba(148,163,184,0.4);
    }
    .box::before {
      content: "";
      position: absolute;
      top: -60px;
      left: -80px;
      width: 220px;
      height: 220px;
      background: radial-gradient(circle, rgba(251,146,60,0.35), transparent 70%);
      pointer-events: none;
      z-index: -1;
    }
    body.dark-mode .box::before {
      background: radial-gradient(circle, rgba(56,189,248,0.3), transparent 70%);
    }

    h2 {
      margin: 4px 0 2px;
      font-weight: 700;
      letter-spacing: 0.05em;
    }
    .subtitle {
      font-size: 0.85rem;
      color: var(--text-sub);
      margin-bottom: 8px;
    }
    body.dark-mode .subtitle {
      color: var(--text-sub-dark);
    }

    .settings-wrapper {
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: max-height 0.35s ease, opacity 0.35s ease;
      width: 100%;
    }
    .settings-wrapper.open {
      max-height: 900px;
      opacity: 1;
    }

    .settings {
      background: rgba(248,250,252,0.95);
      padding: 10px;
      border-radius: 12px;
      text-align: left;
      font-size: 0.82rem;
      margin-bottom: 10px;
      border: 1px solid rgba(148,163,184,0.3);
    }
    body.dark-mode .settings {
      background: rgba(15,23,42,0.95);
      border-color: rgba(148,163,184,0.45);
    }

    .settings-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-sub);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    body.dark-mode .settings-title {
      color: var(--text-sub-dark);
    }

    .settings-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .settings-row label {
      flex: 1.3;
    }
    .settings-row select,
    .settings-row input[type="number"] {
      flex: 1;
      padding: 4px 6px;
      border-radius: 10px;
      border: 1px solid #cbd5f5;
      font-size: 0.8rem;
      box-sizing: border-box;
      background: #ffffff;
    }
    body.dark-mode .settings-row select,
    body.dark-mode .settings-row input[type="number"] {
      background: #020617;
      border-color: #1f2937;
      color: var(--text-main-dark);
    }

    .settings-row input[type="checkbox"] {
      margin-right: 4px;
    }

    .choice-group {
      flex: 2;
      display: flex;
      flex-wrap: wrap;
      gap: 4px 8px;
      font-size: 0.8rem;
    }
    .choice-group label {
      display: flex;
      align-items: center;
      gap: 3px;
      flex: 0 0 auto;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(148,163,184,0.12);
    }
    body.dark-mode .choice-group label {
      background: rgba(15,23,42,0.9);
    }

    #numberDisplay {
      font-weight: 800;
      height: 7.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 14px 0 6px;
      color: #0f172a;
      text-shadow: 0 0 10px rgba(248,250,252,0.7);
      background: radial-gradient(circle, rgba(251,191,36,0.12), transparent 70%);
      border-radius: 16px;
      font-size: 3.2rem;
    }
    body.dark-mode #numberDisplay {
      color: #f9fafb;
      text-shadow: 0 0 16px rgba(250,250,250,0.7);
      background: radial-gradient(circle, rgba(56,189,248,0.18), transparent 70%);
    }

    .anim-pop  { animation: anim-pop 0.28s ease-out; }
    .anim-fade { animation: anim-fade 0.35s ease-out; }
    .anim-slide{ animation: anim-slide 0.32s ease-out; }
    .anim-flash{ animation: anim-flash 0.25s ease-out; }

    @keyframes anim-pop {
      0%   { transform: scale(0.6); opacity: 0; }
      60%  { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1.0); }
    }
    @keyframes anim-fade {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes anim-slide {
      0%   { transform: translateY(30px); opacity: 0; }
      100% { transform: translateY(0);   opacity: 1; }
    }
    @keyframes anim-flash {
      0%   { opacity: 0; transform: scale(0.9); }
      30%  { opacity: 1; transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1.0); }
    }

    #timerDisplay {
      font-size: 0.9rem;
      color: #ef4444;
      min-height: 1.1em;
      margin-bottom: 4px;
    }

    .small-note {
      margin-top: 8px;
      font-size: 0.76rem;
      color: var(--text-sub);
      text-align: left;
    }
    body.dark-mode .small-note {
      color: var(--text-sub-dark);
    }

    /* ปุ่มกลมแถวบนสุด */
    .controls-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 8px;
      margin-bottom: 10px;
    }
    .round-btn {
      width: 58px;
      height: 58px;
      border-radius: 50%;
      border: none;
      font-size: 0.78rem;
      font-weight: 600;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      box-shadow: 0 4px 10px rgba(15,23,42,0.25);
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.15s;
      touch-action: manipulation;
      text-align: center;
      line-height: 1;
    }
    .round-btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 2px 6px rgba(15,23,42,0.3);
      opacity: 0.9;
    }
    #settingsToggle { background: #6b7280; }
    #startBtn      { background: var(--accent-strong); }
    #stopBtn       { background: var(--btn-danger); }
    #resetBtn      { background: var(--btn-secondary); }
    #fullscreenBtn { background: var(--btn-success); }
    body.dark-mode #settingsToggle { background: #4b5563; }
    body.dark-mode #resetBtn       { background: #6b7280; }

    body.theme-blue {
      --accent: #38bdf8;
      --accent-soft: #e0f2fe;
      --accent-strong: #0ea5e9;
      --bg: #e0f2fe;
    }
    body.theme-orange {
      --accent: #fb923c;
      --accent-soft: #ffedd5;
      --accent-strong: #f97316;
      --bg: #fef3c7;
    }
    body.theme-purple {
      --accent: #c084fc;
      --accent-soft: #f3e8ff;
      --accent-strong: #a855f7;
      --bg: #f5f3ff;
    }
    body.theme-green {
      --accent: #4ade80;
      --accent-soft: #dcfce7;
      --accent-strong: #22c55e;
      --bg: #ecfdf5;
    }
    body.dark-mode.theme-blue,
    body.dark-mode.theme-orange,
    body.dark-mode.theme-purple,
    body.dark-mode.theme-green {
      --bg: #020617;
    }

    .dark-toggle-label {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* ==== Challenge panel & keypad ==== */
    .challenge-panel {
      width: 100%;
      margin-top: 6px;
      padding: 8px;
      border-radius: 10px;
      background: rgba(248,250,252,0.85);
      border: 1px solid rgba(148,163,184,0.3);
      box-sizing: border-box;
      display: none;
    }
    body.dark-mode .challenge-panel {
      background: rgba(15,23,42,0.9);
      border-color: rgba(148,163,184,0.45);
    }
    .challenge-status {
      font-size: 0.8rem;
      margin-bottom: 4px;
      text-align: left;
      color: var(--text-sub);
    }
    body.dark-mode .challenge-status {
      color: var(--text-sub-dark);
    }

    /* ช่องคำตอบ – ใหญ่ ชัดเจน */
    #answerInput {
      width: 100%;
      padding: 10px 12px;
      border-radius: 16px;
      border: 2px solid #cbd5f5;
      font-size: 2.4rem;
      box-sizing: border-box;
      margin-bottom: 6px;
      text-align: center;
      min-height: 4.5rem;
      background: #ffffff;
    }
    body.dark-mode #answerInput {
      background: #020617;
      border-color: #1f2937;
      color: var(--text-main-dark);
    }

    #answerFeedback {
      min-height: 1em;
      font-size: 0.8rem;
      margin-bottom: 4px;
      text-align: center;
      color: #0f766e;
    }
    body.dark-mode #answerFeedback {
      color: #6ee7b7;
    }

    /* keypad – ปุ่มวงกลมใหญ่ กดง่าย (ใหญ่กว่าปุ่มเมนูเล็กน้อย) */
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
    }
    .keypad button {
      border-radius: 50%;
      border: none;
      font-size: 1.2rem;
      font-weight: 700;
      background: #e5e7eb;
      color: #111827;
      box-shadow: 0 2px 4px rgba(15,23,42,0.15);
      touch-action: manipulation;
      width: clamp(64px, 20vw, 84px);
      height: clamp(64px, 20vw, 84px);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .keypad button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 3px rgba(15,23,42,0.25);
    }
    body.dark-mode .keypad button {
      background: #1f2937;
      color: #e5e7eb;
    }

    .keypad .key-enter {
      grid-column: span 3;
      border-radius: 999px;
      height: 54px;
      width: 100%;
      background: var(--accent-strong);
      color: #fff;
    }
    .keypad .key-backspace {
      background: #f97316;
      color: #fff;
    }
    .keypad .key-clear {
      background: #ef4444;
      color: #fff;
    }

    .summary-box {
      margin-top: 8px;
      font-size: 0.8rem;
      text-align: left;
      width: 100%;
      color: var(--text-sub);
    }
    body.dark-mode .summary-box {
      color: var(--text-sub-dark);
    }

    .score-form {
      width: 100%;
      margin-top: 6px;
      padding: 8px;
      border-radius: 8px;
      border: 1px dashed rgba(148,163,184,0.5);
      font-size: 0.8rem;
      display: none;
      box-sizing: border-box;
    }
    .score-form label {
      display: block;
      margin-bottom: 4px;
    }
    .score-form input {
      width: 100%;
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid #cbd5f5;
      box-sizing: border-box;
      margin-bottom: 6px;
    }
    body.dark-mode .score-form input {
      background: #020617;
      border-color: #1f2937;
      color: var(--text-main-dark);
    }
    .score-form button {
      width: 100%;
      padding: 6px 0;
      border-radius: 10px;
      border: none;
      background: var(--accent-strong);
      color: #fff;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(15,23,42,0.25);
      touch-action: manipulation;
    }

    .leaderboard-panel {
      margin-top: 10px;
      width: 100%;
      font-size: 0.78rem;
      text-align: left;
    }
    .leaderboard-panel h3 {
      margin: 4px 0;
      font-size: 0.85rem;
    }
    .leaderboard-panel table {
      width: 100%;
      border-collapse: collapse;
    }
    .leaderboard-panel th,
    .leaderboard-panel td {
      border-bottom: 1px solid rgba(148,163,184,0.3);
      padding: 3px 4px;
      text-align: left;
      white-space: nowrap;
    }
    .leaderboard-panel th {
      font-weight: 600;
    }
  </style>
</head>
<body class="theme-orange">
<div class="box" id="appBox">
  <h2>ครูเอฟ จินตคณิต</h2>
  <div class="subtitle">แอปฝึกคิดเลขเร็วแบบเกม จินตคณิต</div>

  <!-- CONTROLS -->
  <div class="controls-row">
    <button id="settingsToggle"  class="round-btn">ตั้งค่า</button>
    <button id="startBtn"       class="round-btn">เริ่ม</button>
    <button id="stopBtn"        class="round-btn">หยุด</button>
    <button id="resetBtn"       class="round-btn">รีเซ็ต</button>
    <button id="fullscreenBtn"  class="round-btn">เต็มจอ</button>
  </div>

  <!-- SETTINGS -->
  <div id="settingsWrapper" class="settings-wrapper">
    <div class="settings">
      <div class="settings-title">โหมดการเล่น</div>
      <div class="settings-row">
        <label>เลือกโหมด</label>
        <div class="choice-group" id="modeGroup">
          <label><input type="radio" name="modeOption" value="practice" checked> ฝึกฝน</label>
          <label><input type="radio" name="modeOption" value="challenge"> ท้าทาย</label>
        </div>
      </div>

      <div class="settings-title">การตั้งค่าโจทย์</div>

      <div class="settings-row">
        <label for="digitSelect">จำนวนหลักของตัวเลข</label>
        <select id="digitSelect">
          <option value="1">1 หลัก (1–9)</option>
          <option value="2" selected>2 หลัก (10–99)</option>
          <option value="3">3 หลัก (100–999)</option>
          <option value="4">4 หลัก (1000–9999)</option>
        </select>
      </div>

      <div class="settings-row">
        <label for="countInput">จำนวนตัวเลขต่อ 1 ข้อ</label>
        <input type="number" id="countInput" value="5" min="1" max="99">
      </div>

      <div class="settings-row">
        <label for="questionCountInput">จำนวนข้อใน 1 รอบ (โหมดฝึกฝน)</label>
        <input type="number" id="questionCountInput" value="5" min="1" max="99">
      </div>

      <div class="settings-row">
        <label for="speedInput">ความเร็วแสดงตัวเลข (ms)</label>
        <input type="number" id="speedInput" value="800" min="1" max="5000">
      </div>

      <div class="settings-row">
        <label for="signModeSelect">โหมดเครื่องหมาย</label>
        <select id="signModeSelect">
          <option value="add">บวกอย่างเดียว</option>
          <option value="addsub" selected>บวกลบ</option>
        </select>
      </div>

      <div class="settings-title">การแสดงผล</div>

      <div class="settings-row">
        <label>ขนาดตัวเลข</label>
        <div class="choice-group" id="sizeGroup">
          <label><input type="radio" name="sizeOption" value="small"> เล็ก</label>
          <label><input type="radio" name="sizeOption" value="medium" checked> กลาง</label>
          <label><input type="radio" name="sizeOption" value="large"> ใหญ่</label>
          <label><input type="radio" name="sizeOption" value="xl"> XL</label>
          <label><input type="radio" name="sizeOption" value="xxl"> XXL</label>
        </div>
      </div>

      <div class="settings-row">
        <label>ธีมสี</label>
        <div class="choice-group" id="themeGroup">
          <label><input type="radio" name="themeOption" value="orange" checked> ส้มสดใส</label>
          <label><input type="radio" name="themeOption" value="blue"> ฟ้าสดใส</label>
          <label><input type="radio" name="themeOption" value="purple"> ม่วง–ชมพู</label>
          <label><input type="radio" name="themeOption" value="green"> เขียวนีออน</label>
        </div>
      </div>

      <div class="settings-row">
        <label class="dark-toggle-label">
          <input type="checkbox" id="darkModeToggle">
          Dark Mode
        </label>
      </div>

      <div class="settings-title">โหมดแข่งขัน & เสียง (ใช้กับโหมดฝึกฝน)</div>

      <div class="settings-row">
        <label>
          <input type="checkbox" id="competitionCheck">
          โหมดแข่งขันจับเวลา (ฝึกฝน)
        </label>
        <input type="number" id="competitionSeconds" value="60" min="5" max="600"
               title="เวลาการแข่งขัน (วินาที)">
      </div>

      <div class="settings-row">
        <label>
          <input type="checkbox" id="voiceCheck">
          เปิดเสียงอ่านตัวเลข/คำตอบ
        </label>
        <select id="voiceLangSelect">
          <option value="th-TH">ไทย (th-TH)</option>
          <option value="en-US" selected>English (en-US)</option>
          <option value="ja-JP">日本語 (ja-JP)</option>
        </select>
      </div>

      <div class="small-note">
        * โหมด “ฝึกฝน”: ระบบเฉลยให้, มีตัวเลือกจำนวนข้อ & โหมดแข่งขันเสริม<br>
        * โหมด “ท้าทาย”: ต้องตอบเองให้ถูก 10 ข้อ, จับเวลาตั้งแต่เลขตัวแรกของข้อที่ 1<br>
        * ไม่สุ่มเลข 0, ผลรวมระหว่างทางไม่ติดลบ, ผลสุดท้ายไม่ติดลบ<br>
        * ตั้งค่าทั้งหมดจะถูกจำไว้ในเครื่องอัตโนมัติ
      </div>
    </div>
  </div>

  <div id="timerDisplay"></div>
  <div id="numberDisplay">เริ่ม?</div>

  <!-- CHALLENGE ANSWER PANEL -->
  <div id="challengePanel" class="challenge-panel">
    <div id="challengeStatus" class="challenge-status"></div>
    <input id="answerInput" type="text" inputmode="numeric" autocomplete="off" placeholder="คำตอบของคุณ">
    <div id="answerFeedback"></div>
    <div class="keypad">
      <button type="button" class="key-digit" data-key="7">7</button>
      <button type="button" class="key-digit" data-key="8">8</button>
      <button type="button" class="key-digit" data-key="9">9</button>

      <button type="button" class="key-digit" data-key="4">4</button>
      <button type="button" class="key-digit" data-key="5">5</button>
      <button type="button" class="key-digit" data-key="6">6</button>

      <button type="button" class="key-digit" data-key="1">1</button>
      <button type="button" class="key-digit" data-key="2">2</button>
      <button type="button" class="key-digit" data-key="3">3</button>

      <button type="button" class="key-backspace">ลบ</button>
      <button type="button" class="key-digit" data-key="0">0</button>
      <button type="button" class="key-clear">ล้าง</button>

      <button type="button" class="key-enter">ENTER</button>
    </div>
  </div>

  <div id="summaryBox" class="summary-box"></div>

  <div id="scoreForm" class="score-form">
    <label for="playerNameInput">ชื่อนักเรียน (สำหรับจัดอันดับ):</label>
    <input id="playerNameInput" type="text" placeholder="เช่น ฟีนิกซ์, ใบตอง">
    <button id="saveScoreBtn" type="button">บันทึกเวลาโหมดท้าทาย</button>
  </div>

  <div class="leaderboard-panel">
    <h3>อันดับโหมดท้าทาย</h3>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>ชื่อ</th>
          <th>เวลา (วิ)</th>
          <th>ผิด</th>
          <th>วันที่</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>
  </div>
</div>

<script>
/* โค้ด JavaScript เหมือนเวอร์ชันก่อนหน้านี้ทุกประการ
   (ไม่มีการแก้ส่วน logic เพิ่มเติม) */
</script>
</body>
</html>
